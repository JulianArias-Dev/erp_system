-- Crear la base de datos
-- CREATE DATABASE erp_system;

-- Tables
-- Crear tabla Products
CREATE TABLE Products (
    id SERIAL PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Code VARCHAR(100) NOT NULL UNIQUE,
    Unit_Price FLOAT NOT NULL,
    Available_Units INTEGER NOT NULL,
    Max_Capacity INTEGER NOT NULL
);

-- Crear tabla Ingredients
CREATE TABLE Ingredients (
    id SERIAL PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Code VARCHAR(100) NOT NULL UNIQUE,
    Available_Units FLOAT NOT NULL,
    Max_Capacity FLOAT NOT NULL,
    Type VARCHAR(50) NOT NULL,
    CONSTRAINT chk_type CHECK (Type IN ('Solido', 'Liquido', 'Envase'))
);

-- Crear tabla Supplier
CREATE TABLE Suppliers (
    id SERIAL PRIMARY KEY,
    Name VARCHAR(255) NOT NULL,
    Contact VARCHAR(255) NOT NULL
);

-- Crear tabla Supplier_Ingredient (relación muchos a muchos)
CREATE TABLE Supplier_Ingredients (
    FK_Supplier INTEGER NOT NULL REFERENCES Suppliers(id) ON DELETE CASCADE,
    FK_Ingredient INTEGER NOT NULL REFERENCES Ingredients(id) ON DELETE CASCADE,
    Quantity INTEGER NOT NULL,
    Price FLOAT NOT NULL,
    PRIMARY KEY (FK_Supplier, FK_Ingredient)
);

-- Crear tabla Recipe
CREATE TABLE Recipes (
    id SERIAL PRIMARY KEY,
    FK_Product INTEGER NOT NULL REFERENCES Products(id) ON DELETE CASCADE,
    Preparation_Time INTEGER NOT NULL
);

-- Crear tabla Recipe_Ingredients (relación muchos a muchos)
CREATE TABLE Recipe_Ingredients (
    FK_Ingredient INTEGER NOT NULL REFERENCES Ingredients(id) ON DELETE CASCADE,
    FK_Recipe INTEGER NOT NULL REFERENCES Recipes(id) ON DELETE CASCADE,
    Quantity FLOAT NOT NULL,
    PRIMARY KEY (FK_Ingredient, FK_Recipe)
);

-- Crear tabla Orders
CREATE TABLE Orders (
    id SERIAL PRIMARY KEY,
    product_id INTEGER NOT NULL REFERENCES Products(id) ON DELETE CASCADE,
    quantity INTEGER NOT NULL,
    date DATE NOT NULL
);

--Tabla para generar fechas de compra
CREATE TABLE dates (
    name VARCHAR(50) PRIMARY KEY,
    date TIMESTAMP NOT NULL
);

-- Test Data
-- Insertar datos en Products
INSERT INTO Products (Name, Code, Unit_Price, Available_Units, Max_Capacity)
VALUES
('Producto A', 'P001', 10.5, 100, 500),
('Producto B', 'P002', 15.0, 200, 600),
('Producto C', 'P003', 8.75, 50, 300);

-- Insertar datos en Ingredients
INSERT INTO Ingredients (Name, Code, Available_Units, Max_Capacity, Type)
VALUES
('Ingrediente X', 'I001', 1000, 5000, 'Líquido'),
('Ingrediente Y', 'I002', 800, 4000, 'Sólido'),
('Ingrediente Z', 'I003', 1500, 7000, 'Líquido');

-- Insertar datos en Supplier
INSERT INTO Suppliers (Name, Contact)
VALUES
('Proveedor A', 'proveedora@example.com'),
('Proveedor B', 'proveedorb@example.com'),
('Proveedor C', 'proveedorc@example.com');

-- Insertar datos en Supplier_Ingredient
INSERT INTO Supplier_Ingredients (FK_Supplier, FK_Ingredient, Quantity, Price)
VALUES
(1, 1, 500, 1.2),
(1, 2, 300, 2.0),
(2, 3, 700, 1.5),
(3, 1, 400, 1.1);

-- Insertar datos en Recipe
INSERT INTO Recipes (FK_Product, Preparation_Time)
VALUES
(1, 60),
(2, 45),
(3, 30);

-- Insertar datos en Recipe_Ingredients
INSERT INTO Recipe_Ingredients (FK_Ingredient, FK_Recipe, Quantity)
VALUES
(1, 1, 2.5),
(2, 1, 1.0),
(3, 2, 3.0),
(1, 3, 0.5);

-- Insertar datos en Orders
INSERT INTO orders (product_id, quantity, date)
VALUES 
    (4, 200, '2024-11-27'), 
    (5, 120, '2024-11-24'),
    (4, 200, '2024-11-27'), 
    (5, 120, '2024-11-24'),
    (6, 130, '2024-11-24');
